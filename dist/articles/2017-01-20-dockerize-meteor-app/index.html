<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v4.2.6"><title>Dockerize Meteor Application | Ganessh Kumar</title><link rel="sitemap" href="/sitemap-index.xml"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Noto+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet"><link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet"><script dangerouslySetInnerHTML="[object Object]"></script><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/2013-09-01-learn-unlearn-relearn.l15eNEwx.css" /><script type="module" src="/_astro/hoisted.l-JsOPk0.js"></script></head> <body> <header> <nav class="bg-white flex border-gray-200 dark:bg-gray-900"> <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4"> <button data-collapse-toggle="navbar-default" type="button" class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-default" aria-expanded="false"> <span class="sr-only">Open main menu</span> <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path> </svg> </button> <div class="hidden w-full md:block md:w-auto" id="navbar-default"> <ul class="font-medium flex flex-col p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 rtl:space-x-reverse md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700"> <li class="mb-0 z-10 text-slate-700"> <a class="no-underline" href="/"> <div class="text-slate-900 cursor-pointer"> Home </div> </a> </li> <li class="mb-0 z-10 font-semibold underline decoration-sky-500 underline-offset-2"> <a class="no-underline" href="/articles"> <div class="text-slate-900 cursor-pointer"> Articles </div> </a> </li> <li class="mb-0 z-10 text-slate-700"> <a class="no-underline" href="/projects"> <div class="text-slate-900 cursor-pointer"> Projects </div> </a> </li>  <li class="mb-0 z-10 text-slate-700"> <a class="no-underline" href="/about"> <div class="text-slate-900 cursor-pointer"> About </div> </a> </li> </ul> </div> </div> </nav> </header>  <div class="container mx-auto w-100 lg:w-2/3 2xl:w-1/2"> <h1 class="font-bold text-4xl cursor-default tracking-wide pb-2 border-b border-sky-600">Dockerize Meteor Application</h1> <div class="flex flex-row justify-between mt-2 mb-10"> <div class="text-slate-500 uppercase text-sm">January 19, 2017</div> <div class="text-slate-500 uppercase text-sm">docker, docker-compose, meteor</div> </div> <div class="markdown"> <p>Letâ€™s start with building our meteor project to make it ready for the production environment. Create a file <code>build-docker.sh</code> in the projectâ€™s root directory.</p>
<pre class="language-shell"><code is:raw="" class="language-shell"><span class="token shebang important">#!/bin/sh</span>
<span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>

<span class="token comment"># meteor doesn't want the build directory to be present under the root folder</span>
meteor build <span class="token parameter variable">--architecture</span><span class="token operator">=</span>os.linux.x86_64 <span class="token punctuation">..</span>/build

<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/build <span class="token operator">&#x26;&#x26;</span> <span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> <span class="token operator">&#x3C;</span>project_name<span class="token operator">></span>.tar.gz <span class="token operator">&#x26;&#x26;</span> <span class="token builtin class-name">cd</span> -
<span class="token function">docker</span> build <span class="token parameter variable">-t</span> <span class="token operator">&#x3C;</span>username<span class="token operator">></span>/<span class="token operator">&#x3C;</span>image_name<span class="token operator">></span> <span class="token builtin class-name">.</span></code></pre>
<ul>
<li><code>meteor build</code> will output &#x3C;project_name>.tar.gz file into the directory <code>build</code> in the projectâ€™s parent directory.</li>
<li><code>tar</code> will unzip the archive and extract out the bundle directory. We need to add this bundle directory to the docker image.</li>
<li><code>docker build</code> will try to create a docker project using the project directory as the context. So we need to add <code>Dockerfile</code> to the project directory.</li>
</ul>
<pre class="language-dockerfile"><code is:raw="" class="language-dockerfile"><span class="token instruction"><span class="token keyword">FROM</span> node:7.4.0</span>

<span class="token instruction"><span class="token keyword">COPY</span> ../build/bundle /app</span>
<span class="token instruction"><span class="token keyword">RUN</span> cd /app/programs/server &#x26;&#x26; npm install</span>
<span class="token instruction"><span class="token keyword">ENV</span> PORT=80</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 80</span>

<span class="token instruction"><span class="token keyword">CMD</span> node /app/main.js</span></code></pre>
<ul>
<li><code>COPY</code> will add the bundle folder to the docker image under /app directory.</li>
<li><code>RUN</code> will install the required npm dependencies.</li>
<li><code>ENV</code> will set the port the server listens to inside the container.</li>
<li><code>EXPOSE</code> will make this port available to be linked outside the container.</li>
<li><code>CMD</code> will start our server when docker container of this image is run.</li>
</ul>
<p>Running the <code>build-docker.sh</code> script will create the docker image. If you are using this locally, you can use <code>docker-compose</code> to easily link the application to a containerized database.</p>
<pre class="language-yaml"><code is:raw="" class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mongo</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mongo<span class="token punctuation">:</span>3.4.0
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"27030:27017"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> $HOME/Data/mongodb<span class="token punctuation">:</span>/data/db
    <span class="token key atrule">command</span><span class="token punctuation">:</span> mongod <span class="token punctuation">-</span><span class="token punctuation">-</span>smallfiles

  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> &#x3C;username<span class="token punctuation">></span>/&#x3C;image_name<span class="token punctuation">></span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"8001:80"</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> MONGO_URL=mongodb<span class="token punctuation">:</span>//mongo<span class="token punctuation">:</span>27017/tasks
      <span class="token punctuation">-</span> ROOT_URL=http<span class="token punctuation">:</span>//appname.local</code></pre>
<ol>
<li>Database(mongo)</li>
</ol>
<ul>
<li>We are exposing the database on port 27030 to the host machine</li>
<li>$HOME/Data/mongodb is mounted on /data/db to persist the data on host machine</li>
</ul>
<ol start="2">
<li>Application(web)</li>
</ol>
<ul>
<li>We are exposing our application on port 8081 of local machine</li>
<li>MONGO_URL is set to connect to mongo service via docker network on port 27017. This is the port that mongodb listens to internally.</li>
</ul> </div> </div>  <footer> <div class="bg-gray-800 text-center py-8"> <div class="container mx-auto w-100 lg:w-2/3 xl:1/2 text-slate-200">
Made with ðŸ’™ by <a class="visited:text-white" rel="me" href="https://github.com/ganesshkumar"><span class="text-white">Ganessh Kumar</span></a><br> <a class="hidden" rel="me" href="https://hachyderm.io/@ganesshkumar">Mastodon</a> </div> </div> </footer> </body></html>